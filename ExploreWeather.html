<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plan Your Journey | ClimaQuest</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      :root {
        /* Dark Mode */
        --bg-gradient: linear-gradient(135deg, #2c3e50, #34495e, #3498db);
        --bg-secondary: #395067;
        --text-primary: #ecf0f1;
        --text-secondary: #bdc3c7;
        --accent-primary: #e09f3e;
        --accent-secondary: #f4d03f;
        --accent-tertiary: #4db6ac;
        --danger: #e74c3c;
        --success: #2ecc71;
        --warning: #f39c12;
        --shadow-color: rgba(0, 0, 0, 0.5);
        --glass-bg: rgba(255, 255, 255, 0.1);
        --card-border-color: rgba(255, 255, 255, 0.2);
        --logo-text-gradient: linear-gradient(
          to right,
          var(--accent-primary),
          var(--accent-secondary)
        );
      }

      body.light-mode {
        /* Light Mode */
        --bg-gradient: linear-gradient(135deg, #e0f7fa, #b2ebf2, #80deea);
        --bg-secondary: #ffffff;
        --text-primary: #1f2937;
        --text-secondary: #4b5563;
        --accent-primary: #ff7043;
        --accent-secondary: #ffa726;
        --accent-tertiary: #009688;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --glass-bg: rgba(255, 255, 255, 0.8);
        --card-border-color: rgba(0, 150, 136, 0.3);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: var(--bg-gradient);
        color: var(--text-primary);
        min-height: 100vh;
        font-size: 16px;
        transition: background 0.3s, color 0.3s;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        transition: grid-template-columns 0.5s ease-in-out;
      }

      @media (min-width: 900px) {
        .container.two-columns {
          grid-template-columns: 450px 1fr;
        }
      }

      /* Header */
      header {
        position: sticky;
        top: 0;
        background-color: var(--bg-secondary);
        box-shadow: 0 0 15px var(--shadow-color);
        padding: 1rem 2rem;
        margin: -20px -20px 20px -20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
        border-bottom: 1px solid var(--accent-tertiary);
        transition: background-color 0.3s, box-shadow 0.3s;
        grid-column: 1 / -1;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .logo img {
        width: 3.5rem;
        border-radius: 1.8rem;
      }
      .logo h1 {
        font-size: 1.8rem;
        font-weight: 700;
        background: var(--logo-text-gradient);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      nav ul {
        display: flex;
        list-style: none;
        gap: 1.5rem;
        align-items: center;
      }
      nav a {
        color: var(--text-primary);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s;
        padding: 0.5rem 1rem;
        font-size: 1rem;
      }
      nav a:hover,
      nav a.active {
        color: var(--accent-primary);
      }

      /* Theme Switch */
      .theme-switch-wrapper {
        display: flex;
        align-items: center;
      }
      .theme-switch {
        display: inline-block;
        height: 34px;
        position: relative;
        width: 60px;
      }
      .theme-switch input {
        display: none;
      }
      .slider {
        background-color: #ccc;
        bottom: 0;
        cursor: pointer;
        left: 0;
        position: absolute;
        right: 0;
        top: 0;
        transition: 0.4s;
      }
      .slider:before {
        background-color: #fff;
        bottom: 4px;
        content: "";
        height: 26px;
        left: 4px;
        position: absolute;
        transition: 0.4s;
        width: 26px;
      }
      input:checked + .slider {
        background-color: var(--accent-tertiary);
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }
      .slider.round {
        border-radius: 34px;
      }
      .slider.round:before {
        border-radius: 50%;
      }

      .page-header {
        text-align: center;
        margin-bottom: 10px;
        grid-column: 1 / -1;
      }
      .page-header h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        background: linear-gradient(
          to right,
          var(--accent-primary),
          var(--accent-secondary)
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      .subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .panel {
        background-color: var(--glass-bg);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        margin: 0;
        box-shadow: 0 10px 30px var(--shadow-color);
        transition: margin 0.5s ease-in-out, background-color 0.3s,
          box-shadow 0.3s;
        border: 1px solid var(--card-border-color);
      }

      .panel.result {
        display: none;
      }

      h2 {
        margin-bottom: 20px;
        color: var(--accent-primary);
        border-bottom: 2px solid var(--accent-tertiary);
        padding-bottom: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
      }
      input,
      select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid transparent;
        border-radius: 8px;
        background-color: #ffffff; /* Default to white for dark mode */
        font-size: 1rem;
        transition: all 0.3s;
        color: #333; /* Default to dark text */
      }
      body.light-mode input,
      body.light-mode select {
        background-color: #f0f7fa;
        border: 1px solid #d1e4e8;
      }
      input:focus,
      select:focus {
        outline: none;
        box-shadow: 0 0 0 3px var(--accent-tertiary);
      }

      body:not(.light-mode) input:focus,
      body:not(.light-mode) select:focus {
        background-color: #f0f0f0; /* Slightly off-white for focus in dark mode */
      }

      body.light-mode input:focus,
      body.light-mode select:focus {
        background-color: #e0f7fa; /* Slightly darker blue for focus in light mode */
      }

      #search-button {
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        color: var(--bg-secondary);
        border: none;
        padding: 14px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s;
        width: 100%;
        margin-top: 10px;
      }
      body.light-mode #search-button {
        color: white;
      }
      #search-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px var(--shadow-color);
      }

      #map {
        height: 300px;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 20px;
      }
      #selected-location {
        font-weight: bold;
        margin-bottom: 10px;
        min-height: 24px;
      }
      .location-info {
        background-color: rgba(0, 0, 0, 0.1);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
      }
      .coordinates {
        display: flex;
        gap: 15px;
        margin-top: 10px;
      }
      .coordinate-item {
        flex: 1;
        text-align: center;
        padding: 10px;
        background-color: rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }
      .coordinate-label {
        font-size: 0.9rem;
        opacity: 0.8;
      }
      .coordinate-value {
        font-size: 1.1rem;
        font-weight: 600;
      }
      .map-instructions {
        text-align: center;
        margin-top: 10px;
        font-style: italic;
        opacity: 0.8;
        font-size: 15px;
      }
      .leaflet-control-attribution {
        display: none;
      }

      .results-section {
        display: none;
      }
      .weather-card {
        background-color: var(--bg-secondary);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px var(--shadow-color);
        transition: background-color 0.3s;
      }

      .condition-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--card-border-color);
      }
      .condition-item:last-child {
        border-bottom: none;
      }
      .condition-name {
        font-weight: 600;
        font-size: 1.1rem;
        width: 120px;
      }
      .probability-bar {
        height: 20px;
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        flex: 1;
        margin: 0 15px;
        overflow: hidden;
      }
      body.light-mode .probability-bar {
        background-color: rgba(0, 0, 0, 0.1);
      }
      .probability-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 1s ease-in-out;
      }
      .probability-text {
        width: 50px;
        text-align: left;
        font-weight: 600;
      }
      .hot {
        background-color: var(--danger);
      }
      .cold {
        background-color: var(--accent-tertiary);
      }
      .windy {
        background-color: var(--warning);
      }
      .wet {
        background-color: var(--success);
      }

      .summary {
        text-align: center;
        margin-top: 25px;
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        font-size: 1.2rem;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }
      .spinner {
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 5px solid var(--text-primary);
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .feature-card {
        background-color: var(--bg-secondary);
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        box-shadow: 0 10px 30px var(--shadow-color);
        transition: all 0.4s;
        border: 1px solid var(--card-border-color);
        position: relative;
        overflow: hidden;
        margin-top: 25px;
      }
      .feature-icon {
        font-size: 3.5rem;
        margin-bottom: 1rem;
        background: linear-gradient(
          to bottom,
          var(--accent-secondary),
          var(--accent-primary)
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        filter: drop-shadow(0 0 8px var(--shadow-color));
      }
      .feature-card h3 {
        font-size: 1.6rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
      }
      .feature-card p {
        line-height: 1.7;
      }

      .cta-button {
        display: inline-block;
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        color: var(--bg-secondary);
        padding: 1rem 2.5rem;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 700;
        font-size: 1.1rem;
        transition: all 0.4s;
        box-shadow: 0 5px 15px var(--shadow-color);
        position: relative;
        overflow: hidden;
        border: none;
        cursor: pointer;
      }
      body.light-mode .cta-button {
        color: white;
      }
      .cta-button:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px var(--shadow-color);
      }

      /* Daily Forecast Cards */
      .detailed-forecast {
        margin-top: 2rem;
      }
      .detailed-forecast h3 {
        font-size: 1.5rem;
        color: var(--text-primary);
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--card-border-color);
      }
      .forecast-days {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
      }
      .forecast-day {
        background-color: rgba(0, 0, 0, 0.15);
        border-radius: 12px;
        padding: 15px;
        transition: all 0.3s ease;
      }
      body.light-mode .forecast-day {
        background-color: rgba(255, 255, 255, 0.6);
      }
      .day-header {
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 10px;
        border-bottom: 1px solid var(--card-border-color);
        padding-bottom: 10px;
      }
      .weather-param {
        display: flex;
        justify-content: space-between;
        font-size: 1rem;
        margin-bottom: 5px;
      }
      .param-label {
        opacity: 0.8;
      }
      .param-value {
        font-weight: 600;
      }
      .day-advice {
        margin-top: 10px;
        font-size: 0.9rem;
        opacity: 0.9;
        border-top: 1px solid var(--card-border-color);
        padding-top: 10px;
      }

      /* Advice Modal */
      .advice-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }
      .advice-modal-overlay.active {
        display: flex;
        opacity: 1;
      }
      .advice-modal-content {
        background-color: var(--bg-secondary);
        border-radius: 15px;
        padding: 30px;
        width: 100%;
        max-width: 800px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px var(--shadow-color);
        border: 1px solid var(--accent-tertiary);
        position: relative;
        transform: scale(0.9);
        transition: transform 0.3s ease-in-out, background-color 0.3s;
      }
      .advice-modal-overlay.active .advice-modal-content {
        transform: scale(1);
      }
      .modal-close-advice {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 2rem;
        color: var(--text-primary);
        background: none;
        border: none;
        cursor: pointer;
        line-height: 1;
      }
      .advice-modal-content h3 {
        font-size: 1.8rem;
        margin-bottom: 20px;
        padding-bottom: 10px;
      }
      .good-advice h3 {
        color: var(--success);
        border-bottom: 2px solid var(--success);
      }
      .bad-advice h3 {
        color: var(--danger);
        border-bottom: 2px solid var(--danger);
        margin-top: 30px;
      }
      .advice-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .advice-list li {
        padding: 10px 0;
        line-height: 1.6;
        font-size: 1.1rem;
      }
      .modal-refresh-container {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--card-border-color);
      }
      #refresh-advice-btn {
        padding: 0.8rem 2rem;
        font-size: 1rem;
      }

      @media (max-width: 900px) {
        .container {
          padding: 10px;
        }
        header {
          flex-direction: column;
          padding: 1rem;
          gap: 1rem;
          margin: -10px -10px 20px -10px;
        }
        nav ul {
          gap: 0.5rem;
          flex-wrap: wrap;
          justify-content: center;
        }
        .page-header h1 {
          font-size: 2.2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">
          <img
            src="https://placehold.co/100x100/2c3e50/d8e2e9?text=CQ"
            class="img"
            alt="ClimaQuest Logo"
          />
          <h1>ClimaQuest</h1>
        </div>
        <nav>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="WeatherSience.html">Weather Science</a></li>
            <li><a href="TeachYourChild.html">Teach Your Child</a></li>
            <li><a href="MyWeather.html">My Weather</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="EngineeringHub.html">Engineering Hub</a></li>
            <li>
              <div class="theme-switch-wrapper">
                <label class="theme-switch" for="checkbox">
                  <input type="checkbox" id="checkbox" />
                  <div class="slider round"></div>
                </label>
              </div>
            </li>
          </ul>
        </nav>
      </header>

      <div class="page-header">
        <h1>Plan Your Journey</h1>
        <p class="subtitle">
          Select your location on the map and get a detailed weather forecast
        </p>
      </div>

      <div class="panel">
        <h2>Interactive Map</h2>
        <div id="map"></div>
        <p class="map-instructions">
          * Click on the map to locate your location or enter the country name *
        </p>

        <div class="location-info">
          <div id="selected-location">Location not yet determined</div>
          <input
            type="text"
            id="placeInput"
            placeholder="Enter your destination"
            required
          />
          <div class="coordinates">
            <div class="coordinate-item">
              <div class="coordinate-label">Latitude</div>
              <div class="coordinate-value" id="lat">--</div>
            </div>
            <div class="coordinate-item">
              <div class="coordinate-label">Longitude</div>
              <div class="coordinate-value" id="lon">--</div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="startDate">Start Date</label>
          <input type="date" id="startDate" required />
        </div>

        <div class="form-group">
          <label for="endDate">End Date</label>
          <input type="date" id="endDate" required />
        </div>

        <div class="form-group">
          <label for="Trip-type">Trip type</label>
          <select id="type" name="Trip">
            <option value="" selected disabled hidden>
              -- Select a Trip --
            </option>
            <option value="business">Business</option>
            <option value="vacation">Vacation</option>
            <option value="adventure">Adventure</option>
            <option value="relaxation">Relaxation</option>
          </select>
        </div>

        <button id="search-button">Get Forecasts</button>
      </div>

      <div class="panel result">
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>Analyzing data and generating forecasts...</p>
        </div>

        <section class="results-section" id="results">
          <h2>Results</h2>
          <div class="weather-card">
            <div class="condition-item">
              <div class="condition-name">Very Hot</div>
              <div class="probability-bar">
                <div
                  class="probability-fill hot"
                  id="hot-probability"
                  style="width: 0%"
                ></div>
              </div>
              <div class="probability-text" id="hot-text">0%</div>
            </div>
            <div class="condition-item">
              <div class="condition-name">Very Cold</div>
              <div class="probability-bar">
                <div
                  class="probability-fill cold"
                  id="cold-probability"
                  style="width: 0%"
                ></div>
              </div>
              <div class="probability-text" id="cold-text">0%</div>
            </div>
            <div class="condition-item">
              <div class="condition-name">Strong Winds</div>
              <div class="probability-bar">
                <div
                  class="probability-fill windy"
                  id="windy-probability"
                  style="width: 0%"
                ></div>
              </div>
              <div class="probability-text" id="windy-text">0%</div>
            </div>
            <div class="condition-item">
              <div class="condition-name">Severe Rain</div>
              <div class="probability-bar">
                <div
                  class="probability-fill wet"
                  id="wet-probability"
                  style="width: 0%"
                ></div>
              </div>
              <div class="probability-text" id="wet-text">0%</div>
            </div>
          </div>
          <div class="summary" id="summary">
            The forecast summary will appear here
          </div>
          <div class="feature-card result" id="advice-prompt-card"></div>
        </section>
      </div>
    </div>

    <!-- ADVICE MODAL -->
    <div class="advice-modal-overlay" id="advice-modal">
      <div class="advice-modal-content">
        <button class="modal-close-advice">&times;</button>
        <div class="good-advice">
          <h3><i class="fas fa-check-circle"></i> Smart Choices</h3>
          <ul class="advice-list" id="good-advice-list"></ul>
        </div>
        <div class="bad-advice">
          <h3><i class="fas fa-exclamation-triangle"></i> Things to Avoid</h3>
          <ul class="advice-list" id="bad-advice-list"></ul>
        </div>
        <div class="modal-refresh-container">
          <button id="refresh-advice-btn" class="cta-button">
            Get Another Tip
          </button>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      "use strict";
      const RightChoiseAdvices = {
        highTemp: [
          "✅ Great choice! Wear light, breathable clothing like cotton or linen.",
          "✅ Perfect! Remember to stay hydrated by drinking plenty of water.",
          "✅ Smart move. Apply sunscreen generously and wear a wide-brimmed hat.",
          "✅ Good thinking! Plan outdoor activities for the cooler morning or evening hours.",
          "✅ Excellent idea! This is the perfect weather for swimming or visiting an air-conditioned museum.",
        ],
        lowTemp: [
          "✅ Great choice! Dress in warm layers to trap heat effectively.",
          "✅ Perfect! Wear a hat, gloves, and a scarf to protect against heat loss.",
          "✅ Smart move. Choose insulated and waterproof footwear to keep your feet warm and dry.",
          "✅ Good thinking! Enjoy warm beverages like hot chocolate or tea.",
          "✅ Excellent idea! This is ideal weather for cozy indoor activities or winter sports.",
        ],
        windy: [
          "✅ Great choice! A windbreaker jacket will keep you comfortable.",
          "✅ Perfect! Secure any loose items like hats or scarves.",
          "✅ Smart move. This is a great day for flying a kite at a park.",
          "✅ Good thinking! Be cautious if cycling or driving a tall vehicle.",
        ],
        rainy: [
          "✅ Great choice! A waterproof jacket and boots are your best friends today.",
          "✅ Perfect! Don't forget a sturdy umbrella.",
          "✅ Smart move. This is the perfect opportunity to visit an indoor gallery, cinema, or a cozy café.",
          "✅ Good thinking! Allow extra travel time as roads may be slippery.",
        ],
        normal: [
          "✅ Great choice! The weather is perfect for a wide range of outdoor activities like hiking or a picnic.",
          "✅ Perfect! It's an ideal day for exploring the city on foot.",
          "✅ Smart move. Bring a light jacket or sweater, as it might get cooler in the evening.",
        ],
      };
      const wrongChoiseAdvices = {
        highTemp: [
          "⚠️ Be careful! Avoid wearing dark, heavy fabrics that absorb heat.",
          "⚠️ Heads up! Strenuous outdoor exercise during midday can lead to heatstroke.",
          "⚠️ Watch out! Forgetting to drink water can quickly lead to dehydration.",
          "⚠️ Don't risk it! Never leave children or pets unattended in a vehicle.",
        ],
        lowTemp: [
          "⚠️ Be careful! Insufficient clothing can increase the risk of hypothermia.",
          "⚠️ Heads up! Try to limit the amount of exposed skin to prevent frostbite.",
          "⚠️ Watch out! Cotton clothing is not ideal as it holds moisture and can make you colder if it gets wet.",
          "⚠️ Don't risk it! Avoid long periods of inactivity outdoors.",
        ],
        windy: [
          "⚠️ Be careful! Using a flimsy umbrella can be difficult and result in it breaking.",
          "⚠️ Heads up! Activities like boating or paddleboarding can be dangerous in high winds.",
          "⚠️ Watch out! A picnic might be challenging with things blowing away.",
          "⚠️ Don't risk it! Avoid walking near construction sites where debris could be dislodged.",
        ],
        rainy: [
          "⚠️ Be careful! Wearing shoes made of canvas or suede will likely result in wet, cold feet.",
          "⚠️ Heads up! Driving too fast on wet roads can be very dangerous.",
          "⚠️ Watch out! Some hiking trails can become extremely slippery and hazardous when wet.",
          "⚠️ Don't risk it! Planning activities in areas known for flash flooding is a bad idea.",
        ],
        normal: [
          "⚠️ Heads up! Even on a mild day, you can get a sunburn. Consider sunscreen.",
          "⚠️ Be careful! Don't assume the temperature will stay the same all day; a cool evening can catch you unprepared without an extra layer.",
        ],
      };

      document.addEventListener("DOMContentLoaded", function () {
        let map;
        let marker = null;
        let selectedLat = null;
        let selectedLng = null;
        let lastPredictions = null;

        // --- THEME SWITCHER LOGIC ---
        const themeToggle = document.getElementById("checkbox");
        const body = document.body;

        const applyTheme = (theme) => {
          if (theme === "light-mode") {
            body.classList.add("light-mode");
            themeToggle.checked = true;
          } else {
            body.classList.remove("light-mode");
            themeToggle.checked = false;
          }
        };

        themeToggle.addEventListener("change", function () {
          if (this.checked) {
            body.classList.add("light-mode");
            localStorage.setItem("theme", "light-mode");
          } else {
            body.classList.remove("light-mode");
            localStorage.setItem("theme", "dark-mode");
          }
        });

        const savedTheme = localStorage.getItem("theme");
        applyTheme(savedTheme || "dark-mode");

        // --- Main Initialization ---
        function init() {
          initMap();
          setupEventListeners();
          setDefaultDates();
          document.getElementById("loading").style.display = "none";
          document.getElementById("results").style.display = "none";
        }

        function initMap() {
          map = L.map("map").setView([30.0444, 31.2357], 5);
          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
          }).addTo(map);
          map.on("click", function (e) {
            document.getElementById("placeInput").value = "";
            updateLocation(e.latlng.lat, e.latlng.lng, "Selected on map");
          });
          navigator.geolocation?.getCurrentPosition(
            function (position) {
              const { latitude, longitude } = position.coords;
              map.setView([latitude, longitude], 10);
              updateLocation(latitude, longitude, "Your Current Location");
            },
            function (error) {
              console.warn("Could not get user location:", error.message);
              updateLocation(30.0444, 31.2357, "Cairo, Egypt (Default)");
            }
          );
        }

        function setupEventListeners() {
          document
            .getElementById("search-button")
            .addEventListener("click", handleForecastRequest);
          document
            .querySelector(".modal-close-advice")
            .addEventListener("click", hideAdviceModal);
          document
            .getElementById("advice-modal")
            .addEventListener("click", (e) => {
              if (e.target.id === "advice-modal") hideAdviceModal();
            });
          document
            .getElementById("refresh-advice-btn")
            .addEventListener("click", setRandomAdvice);
        }

        async function handleForecastRequest() {
          const query = document.getElementById("placeInput").value.trim();
          if (query) {
            try {
              const response = await fetch(
                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(
                  query
                )}`
              );
              const data = await response.json();
              if (data && data.length > 0) {
                const { lat, lon, display_name } = data[0];
                updateLocation(parseFloat(lat), parseFloat(lon), display_name);
                generateForecast();
              } else {
                alert("Place not found. Please try again.");
              }
            } catch (err) {
              alert("Geocoding service failed. Please try again later.");
              console.error(err);
            }
          } else if (selectedLat && selectedLng) {
            generateForecast();
          } else {
            alert("Please enter a destination or click a location on the map.");
          }
        }

        function setDefaultDates() {
          const today = new Date();
          const nextWeek = new Date();
          nextWeek.setDate(today.getDate() + 7);
          document.getElementById("startDate").valueAsDate = today;
          document.getElementById("endDate").valueAsDate = nextWeek;
        }

        function updateLocation(lat, lng, displayName) {
          selectedLat = lat;
          selectedLng = lng;
          if (marker) map.removeLayer(marker);
          marker = L.marker([lat, lng])
            .addTo(map)
            .bindPopup(displayName)
            .openPopup();
          map.setView([lat, lng], 10);
          document.getElementById("selected-location").textContent =
            displayName;
          document.getElementById("lat").textContent = lat.toFixed(4);
          document.getElementById("lon").textContent = lng.toFixed(4);
        }
        async function generateForecast() {
          const startDateStr = document.getElementById("startDate").value;
          const endDateStr = document.getElementById("endDate").value;
          const container = document.querySelector(".container");

          if (!startDateStr || !endDateStr) {
            alert("Please select both a start and end date.");
            return;
          }
          if (new Date(endDateStr) < new Date(startDateStr)) {
            alert("End date cannot be before the start date.");
            return;
          }

          document.getElementById("loading").style.display = "block";
          document.getElementById("results").style.display = "none";
          document.getElementById("advice-prompt-card").classList.add("result");
          container.classList.add("two-columns");
          document.querySelector(".panel.result").style.display = "block";

          try {
            // MOCK DATA - Replace with your actual backend call
            const mockPredictions = generateMockPredictions(
              startDateStr,
              endDateStr
            );
            lastPredictions = processPredictions(mockPredictions);
            updateUI(lastPredictions);
            displayDetailedForecast(lastPredictions.detailedPredictions);
          } catch (error) {
            console.error("Failed to get weather data:", error);
            document.getElementById(
              "summary"
            ).textContent = `Error: ${error.message}`;
          } finally {
            document.getElementById("loading").style.display = "none";
            document.getElementById("results").style.display = "block";
            const adviceCard = document.getElementById("advice-prompt-card");
            adviceCard.innerHTML = `
                  <div class="feature-icon"><i class="fas fa-info-circle"></i></div>
                  <h3>Need Some Advice?</h3>
                  <p>Based on the forecast, we can provide some tips for a better trip.</p>
                  <br />
                  <button class="cta-button knowMore">Get Trip Advice</button>
              `;
            adviceCard.classList.remove("result");
            adviceCard
              .querySelector(".knowMore")
              .addEventListener("click", displayAdviceModal);
          }
        }

        function generateMockPredictions(startDateStr, endDateStr) {
          const predictions = [];
          const start = new Date(startDateStr);
          const end = new Date(endDateStr);
          let dayCount = 1;

          for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
            predictions.push({
              day: dayCount++,
              date: d.toLocaleDateString(),
              temperature: (Math.random() * 30 + 5).toFixed(1), // Random temp between 5 and 35
              wind_speed: (Math.random() * 10).toFixed(1),
              humidity: (Math.random() * 60 + 30).toFixed(1),
              advice: [
                "Pack for variable conditions.",
                "A light jacket is recommended.",
              ],
            });
          }
          return predictions;
        }

        function displayDetailedForecast(predictions) {
          const resultsSection = document.getElementById("results");

          const existingDetails = document.getElementById("detailed-forecast");
          if (existingDetails) {
            existingDetails.remove();
          }
          const detailsSection = document.createElement("div");
          detailsSection.id = "detailed-forecast";
          detailsSection.className = "detailed-forecast";

          detailsSection.innerHTML = `
              <h3>Daily Forecast</h3>
              <div class="forecast-days" id="forecast-days"></div>
          `;
          const adviceCard = document.getElementById("advice-prompt-card");
          resultsSection.insertBefore(detailsSection, adviceCard);

          const forecastDays = document.getElementById("forecast-days");
          predictions.forEach((day) => {
            const dayElement = document.createElement("div");
            dayElement.className = "forecast-day";
            dayElement.innerHTML = `
                  <div class="day-header">
                      <strong>Day ${day.day}</strong> - ${day.date}
                  </div>
                  <div class="day-details">
                      <div class="weather-param">
                          <span class="param-label">Temperature:</span>
                          <span class="param-value">${day.temperature}°C</span>
                      </div>
                      <div class="weather-param">
                          <span class="param-label">Wind Speed:</span>
                          <span class="param-value">${day.wind_speed} m/s</span>
                      </div>
                      <div class="weather-param">
                          <span class="param-label">Humidity:</span>
                          <span class="param-value">${day.humidity}%</span>
                      </div>
                      <div class="day-advice">
                          ${day.advice
                            .map(
                              (advice) =>
                                `<div class="advice-item">${advice}</div>`
                            )
                            .join("")}
                      </div>
                  </div>
              `;
            forecastDays.appendChild(dayElement);
          });
        }

        function processPredictions(predictions) {
          let hotDays = 0,
            coldDays = 0,
            windyDays = 0,
            wetDays = 0;
          const totalDays = predictions.length;

          predictions.forEach((prediction) => {
            if (prediction.temperature > 32) hotDays++;
            if (prediction.temperature < 10) coldDays++;
            if (prediction.wind_speed > 8) windyDays++;
            if (prediction.humidity > 80) wetDays++;
          });

          return {
            hot: Math.round((hotDays / totalDays) * 100),
            cold: Math.round((coldDays / totalDays) * 100),
            windy: Math.round((windyDays / totalDays) * 100),
            wet: Math.round((wetDays / totalDays) * 100),
            detailedPredictions: predictions,
          };
        }

        function updateUI(predictions) {
          updateProbabilityBar("hot", predictions.hot);
          updateProbabilityBar("cold", predictions.cold);
          updateProbabilityBar("windy", predictions.windy);
          updateProbabilityBar("wet", predictions.wet);
          updateSummary(predictions);
        }

        function updateProbabilityBar(condition, probability) {
          document.getElementById(
            `${condition}-probability`
          ).style.width = `${probability}%`;
          document.getElementById(
            `${condition}-text`
          ).textContent = `${probability}%`;
        }

        function updateSummary(predictions) {
          const summaryElement = document.getElementById("summary");
          const options = { year: "numeric", month: "long", day: "numeric" };
          const startDate = new Date(
            document.getElementById("startDate").value
          ).toLocaleDateString("en-US", options);
          const endDate = new Date(
            document.getElementById("endDate").value
          ).toLocaleDateString("en-US", options);
          const periodString = `For the period from ${startDate} to ${endDate}`;
          let conditions = [];
          if (predictions.hot > 30)
            conditions.push(`a ${predictions.hot}% chance of hot days`);
          if (predictions.cold > 30)
            conditions.push(`a ${predictions.cold}% chance of cold days`);
          if (predictions.windy > 30)
            conditions.push(`a ${predictions.windy}% chance of strong winds`);
          if (predictions.wet > 30)
            conditions.push(`a ${predictions.wet}% chance of rain`);
          summaryElement.textContent =
            conditions.length > 0
              ? `${periodString}, expect ${conditions.join(", ")}.`
              : `${periodString}, weather conditions are expected to be generally mild.`;
        }

        function setRandomAdvice() {
          if (!lastPredictions) return;
          let dominantCondition = "normal";
          let maxProb = 0;
          if (lastPredictions.hot > maxProb) {
            maxProb = lastPredictions.hot;
            dominantCondition = "highTemp";
          }
          if (lastPredictions.cold > maxProb) {
            maxProb = lastPredictions.cold;
            dominantCondition = "lowTemp";
          }
          if (lastPredictions.windy > maxProb) {
            maxProb = lastPredictions.windy;
            dominantCondition = "windy";
          }
          if (lastPredictions.wet > maxProb) {
            maxProb = lastPredictions.wet;
            dominantCondition = "rainy";
          }
          if (maxProb < 25) dominantCondition = "normal";

          const goodAdvice = RightChoiseAdvices[dominantCondition];
          const badAdvice = wrongChoiseAdvices[dominantCondition];
          const goodList = document.getElementById("good-advice-list");
          const badList = document.getElementById("bad-advice-list");
          const randomGoodAdvice =
            goodAdvice[Math.floor(Math.random() * goodAdvice.length)];
          const randomBadAdvice =
            badAdvice[Math.floor(Math.random() * badAdvice.length)];
          goodList.innerHTML = `<li>${randomGoodAdvice}</li>`;
          badList.innerHTML = `<li>${randomBadAdvice}</li>`;
        }

        function displayAdviceModal() {
          setRandomAdvice();
          document.getElementById("advice-modal").classList.add("active");
        }

        function hideAdviceModal() {
          document.getElementById("advice-modal").classList.remove("active");
        }

        init();
      });
    </script>
  </body>
</html>
